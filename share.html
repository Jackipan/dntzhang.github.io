<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title></title>
</head>
<body>
<style>
    html,body,ul,li{
        margin:0;
        padding:0;
        border:0;
    }

#scroll li{
    list-style:none;
    height: 30px;
    line-height:30px;
    
}

</style>
<div id="debuglogs" style="position:absolute;top:0px;height: 60px;width: 320px;overflow: scroll;"></div>
<div id="warpper" style="width:100%;height:180px;bottom:0;overflow: hidden;position: relative;">
    <ul style="position:absolute;top:0px;width:100%; text-align: center;" id="scroll">
        <li>累计</li>
     <li>2015年9月</li>
        <li>2015年8月</li>
        <li>2015年7月</li>
        <li>2015年6月</li>
        <li>2015年5月</li>
        <li>2015年4月</li>
        <li>2015年3月</li>
        <li>2015年2月</li>
        <li>2015年1月</li>
        <li>2014年12月</li>
        <li>2014年11月</li>
        <li>2014年10月</li>
       
    </ul>


</div>
<script>
    var debuglogs=document.getElementById('debuglogs');
    var scroll = document.getElementById("scroll"),warpper= document.getElementById("warpper"), preY, logs = [], speed = 0, loop,step=40,checkLoop;
    var maxTop=parseInt(window.getComputedStyle(scroll).height)-parseInt(window.getComputedStyle(warpper).height);
    scroll.addEventListener("touchmove", function (evt) {
        var dy = evt.touches[0].pageY - preY;
        preY = evt.touches[0].pageY;
        var positionY = (parseInt(window.getComputedStyle(scroll).top) + dy);
        if (positionY <= 0&&Math.abs(positionY)<maxTop ) {
            scroll.style.top = positionY + "px";
        }

        logs.unshift({time: new Date().getTime(), y: preY});
        evt.preventDefault();
    }, false);

    scroll.addEventListener("touchstart", function (evt) {
        clearInterval(loop);
        clearInterval(checkLoop);
        logs.length = 0;
        preY = evt.touches[0].pageY;
        speed = 0;
        evt.preventDefault();
    }, false);

    //根据前两次touchmove坐标和时间，以及touchend的坐标和时间，来决定滚动方向和速度
    scroll.addEventListener("touchend", function (evt) {
        var now = new Date().getTime();
        var y = evt.changedTouches[0].pageY;
        if (logs.length > 1) {
           // if (now - logs[0].time < 500) {

                speed = 1000 * (logs[0].y - logs[1].y) / (logs[0].time - logs[1].time) / 60;
                initLoop();
          //  }else{
             //   checkEnd();
          //  }


        }
        evt.preventDefault();
    }, false);

    function initLoop() {
        loop = setInterval(function () {
            console.log('loop1')
            var positionY = (parseInt(window.getComputedStyle(scroll).top) + speed);
            if (positionY <= 0&&Math.abs(positionY)<maxTop) {
                scroll.style.top = positionY + "px";
            }

            speed /= 1.1;
            if (Math.abs(speed) < 0.1){
                clearInterval(loop);
                checkEnd();
            }
        }, 16)
    }

    function checkEnd(){
        var positionY = parseInt(window.getComputedStyle(scroll).top);
        var rpt=Math.floor(Math.abs(positionY/step)) ;
        var dy= positionY%step;
        console.log(rpt,dy)
        if(Math.abs(dy) >step/2){

            toTop(scroll,-1*(rpt+1)*step,400);
               // scroll.style.top = -1*(rpt+1)*step + "px";


            }else{
            toTop(scroll,-1*rpt*step,400);
            //scroll.style.top = -1*rpt*step + "px";
        }
    }

    function toTop(el,top,time){
        var dTop=top- parseInt(window.getComputedStyle(scroll).top);
         var current=parseInt(window.getComputedStyle(scroll).top);
        var start=new Date();
        checkLoop=setInterval(function(){
            console.log('loop2')
          
            var dt=new Date()-start;
              debuglogs.innerHTML=dt+"开始较真";
            if(dt>=time){
                clearInterval(checkLoop);
                debuglogs.innerHTML="较真完毕381111";
                el.style.top = top + 'px';
                return;
            }
        
               var val=dTop*dt/time+current;
            el.style.top = val + 'px';

        },16);


    }
</script>
</body>
</html>
