<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title></title>
</head>
<body>
<style>
    html,body,ul,li{
        margin:0;
        padding:0;
        border:0;
    }

#scroll li{
    list-style:none;
    height: 40px;
}
</style>
<div style="width:200px;height:300px;overflow: hidden;position: relative;">
    <ul style="position:absolute;top:0px;" id="scroll">
     <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
        <li>sfsfdssfjslfjdsl</li>
    </ul>


</div>
<script>
    var scroll = document.getElementById("scroll"), preY, logs = [], speed = 0, loop,step=40;
    scroll.addEventListener("touchmove", function (evt) {
        var dy = evt.touches[0].pageY - preY;
        preY = evt.touches[0].pageY;
        var positionY = (parseInt(window.getComputedStyle(scroll).top) + dy);
        if (positionY <= 0) {
            scroll.style.top = positionY + "px";
        }

        logs.unshift({time: new Date().getTime(), y: preY});
        evt.preventDefault();
    }, false);

    scroll.addEventListener("touchstart", function (evt) {
        clearInterval(loop);
        logs.length = 0;
        preY = evt.touches[0].pageY;
        speed = 0;
        evt.preventDefault();
    }, false);

    //根据前两次touchmove坐标和时间，以及touchend的坐标和时间，来决定滚动方向和速度
    scroll.addEventListener("touchend", function (evt) {
        var now = new Date().getTime();
        var y = evt.changedTouches[0].pageY;
        if (logs.length > 1) {
            if (now - logs[0].time < 500) {

                speed = 1000 * (logs[0].y - logs[1].y) / (logs[0].time - logs[1].time) / 60;
                initLoop();
            }else{
                checkEnd();
            }


        }
        evt.preventDefault();
    }, false);

    function initLoop() {
        loop = setInterval(function () {

            var positionY = (parseInt(window.getComputedStyle(scroll).top) + speed);
            if (positionY <= 0) {
                scroll.style.top = positionY + "px";
            }

            speed /= 1.1;
            if (Math.abs(speed) < 0.1){
                clearInterval(loop);
                checkEnd();
            }
        }, 16)
    }

    function checkEnd(){
        var positionY = parseInt(window.getComputedStyle(scroll).top);
        var rpt=Math.floor(positionY/step) ;
        var dy= positionY%step;
        if(dy>step/2){


                scroll.style.top = (rpt+1)*step + "px";


            }else{
            scroll.style.top = rpt*step + "px";
        }
    }
</script>
</body>
</html>
